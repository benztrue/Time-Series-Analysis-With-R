<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Time Series Objects | Introduction to Time Series Analysis With R</title>
  <meta name="description" content="Chapter 4 Time Series Objects | Introduction to Time Series Analysis With R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Time Series Objects | Introduction to Time Series Analysis With R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Time Series Objects | Introduction to Time Series Analysis With R" />
  
  
  

<meta name="author" content="Nicola Righetti" />


<meta name="date" content="2021-02-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidyverse.html"/>
<link rel="next" href="a-caucus-race-and-a-long-tale.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Time Series with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to Time Series Analysis With R</a></li>
<li class="chapter" data-level="2" data-path="basic-r-syntax-and-the-tidyverse-package.html"><a href="basic-r-syntax-and-the-tidyverse-package.html"><i class="fa fa-check"></i><b>2</b> Basic R Syntax and the Tidyverse Package</a><ul>
<li class="chapter" data-level="2.1" data-path="basic-r-syntax-and-the-tidyverse-package.html"><a href="basic-r-syntax-and-the-tidyverse-package.html#objects"><i class="fa fa-check"></i><b>2.1</b> Objects</a></li>
<li class="chapter" data-level="2.2" data-path="basic-r-syntax-and-the-tidyverse-package.html"><a href="basic-r-syntax-and-the-tidyverse-package.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>3</b> Tidyverse</a></li>
<li class="chapter" data-level="4" data-path="time-series-objects.html"><a href="time-series-objects.html"><i class="fa fa-check"></i><b>4</b> Time Series Objects</a><ul>
<li class="chapter" data-level="4.1" data-path="time-series-objects.html"><a href="time-series-objects.html#plot-time-series-objects"><i class="fa fa-check"></i><b>4.1</b> Plot Time Series Objects</a></li>
<li class="chapter" data-level="4.2" data-path="time-series-objects.html"><a href="time-series-objects.html#create-time-series-object"><i class="fa fa-check"></i><b>4.2</b> Create Time Series Object</a><ul>
<li class="chapter" data-level="4.2.1" data-path="time-series-objects.html"><a href="time-series-objects.html#handle-dates-and-times"><i class="fa fa-check"></i><b>4.2.1</b> Handle Dates and Times</a></li>
<li class="chapter" data-level="4.2.2" data-path="time-series-objects.html"><a href="time-series-objects.html#aggregate-observations"><i class="fa fa-check"></i><b>4.2.2</b> Aggregate Observations</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="time-series-objects.html"><a href="time-series-objects.html#irregular-frequencies"><i class="fa fa-check"></i><b>4.3</b> Irregular Frequencies</a></li>
<li class="chapter" data-level="4.4" data-path="time-series-objects.html"><a href="time-series-objects.html#incomplete-data-points"><i class="fa fa-check"></i><b>4.4</b> Incomplete Data Points</a></li>
<li class="chapter" data-level="4.5" data-path="time-series-objects.html"><a href="time-series-objects.html#plot-many-time-series"><i class="fa fa-check"></i><b>4.5</b> Plot Many Time Series</a></li>
<li class="chapter" data-level="4.6" data-path="time-series-objects.html"><a href="time-series-objects.html#find-and-annotate-peaks"><i class="fa fa-check"></i><b>4.6</b> Find and Annotate Peaks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-caucus-race-and-a-long-tale.html"><a href="a-caucus-race-and-a-long-tale.html"><i class="fa fa-check"></i><b>5</b> A caucus-race and a long tale</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Time Series Analysis With R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series-objects" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Time Series Objects</h1>
<p>Load the dataset “AirPassengers”, which is already present in R, by using the function “data”.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="time-series-objects.html#cb41-1"></a><span class="kw">data</span>(AirPassengers)</span></code></pre></div>
<p>You can see the standard structure of this time series dataset below. This is a univariate time series representing monthly totals of international airline passengers from 1949 to 1960.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="time-series-objects.html#cb42-1"></a>AirPassengers</span></code></pre></div>
<pre><code>##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 1949 112 118 132 129 121 135 148 148 136 119 104 118
## 1950 115 126 141 135 125 149 170 170 158 133 114 140
## 1951 145 150 178 163 172 178 199 199 184 162 146 166
## 1952 171 180 193 181 183 218 230 242 209 191 172 194
## 1953 196 196 236 235 229 243 264 272 237 211 180 201
## 1954 204 188 235 227 234 264 302 293 259 229 203 229
## 1955 242 233 267 269 270 315 364 347 312 274 237 278
## 1956 284 277 317 313 318 374 413 405 355 306 271 306
## 1957 315 301 356 348 355 422 465 467 404 347 305 336
## 1958 340 318 362 348 363 435 491 505 404 359 310 337
## 1959 360 342 406 396 420 472 548 559 463 407 362 405
## 1960 417 391 419 461 472 535 622 606 508 461 390 432</code></pre>
<p>Every R object belongs to a “class” of object. You can use the function “class” to find the class of an object. The class of a standard time series objects is “ts”, which stands for time series.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="time-series-objects.html#cb44-1"></a><span class="kw">class</span>(AirPassengers)</span></code></pre></div>
<pre><code>## [1] &quot;ts&quot;</code></pre>
<p>Every time series has a start and an end date. It has also a frequency, that is the frequency at which the observations were taken. Importantly, the frequency is assumed to be regular over time. For instance, this series starts on January 1949 (use the function start() to see it) and ends on December 1969 (use the function end() to see it). The frequency is monthly, equal to 12 months (use the function frequency() to see it).</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="time-series-objects.html#cb46-1"></a><span class="kw">start</span>(AirPassengers)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 1949</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="time-series-objects.html#cb48-1"></a><span class="kw">end</span>(AirPassengers)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 1960</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="time-series-objects.html#cb50-1"></a><span class="kw">frequency</span>(AirPassengers)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<div id="plot-time-series-objects" class="section level2">
<h2><span class="header-section-number">4.1</span> Plot Time Series Objects</h2>
<p>To plot a ts object you can simply rely on the function plot(), or better, the function plot.ts(), more appropriate for time series objects.</p>
<p>In the function plot.ts you can specify a label for the y axis, (ylab=“your label”), and also for the x axis, if you want (xlab=“your label”).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="time-series-objects.html#cb52-1"></a><span class="kw">plot.ts</span>(AirPassengers, <span class="dt">ylab =</span> <span class="st">&quot;Passengers (1000&#39;s)&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<p>The function plot.ts() has many arguments and you can use them to customize your plot. To see how the function works and how you can customize your plots, just write ?plot.ts in the console and read the help section.</p>
<p>For instance, we can give the plot a title, set the axis labels, the color (use colors() to see the list of standard colors in R) and the size of the line.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="time-series-objects.html#cb53-1"></a><span class="kw">plot.ts</span>(AirPassengers, </span>
<span id="cb53-2"><a href="time-series-objects.html#cb53-2"></a>     <span class="dt">main =</span> <span class="st">&quot;PASSENGERS&quot;</span>,</span>
<span id="cb53-3"><a href="time-series-objects.html#cb53-3"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Passengers (1000&#39;s)&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Time (1949-1960 monthly data)&quot;</span>,</span>
<span id="cb53-4"><a href="time-series-objects.html#cb53-4"></a>     <span class="dt">col =</span> <span class="st">&quot;steelblue2&quot;</span>, </span>
<span id="cb53-5"><a href="time-series-objects.html#cb53-5"></a>     <span class="dt">lwd=</span><span class="dv">5</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
</div>
<div id="create-time-series-object" class="section level2">
<h2><span class="header-section-number">4.2</span> Create Time Series Object</h2>
<p>Let’s create a time series object starting from a sample of data retrieved from Media Cloud, an online free tool that monitors many online news media. We searched the keyword “elections” on a sample of US online news media.</p>
<p>First, we upload the data with the function read.csv()</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="time-series-objects.html#cb54-1"></a>elections_news &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;./data/elections-stories-over-time-20210111144254.csv&quot;</span>)</span></code></pre></div>
<p>We can check the nature of our dataset by using the function str(), which stands for “structure”. We can see that the object is a “data.frame”, it has 4 variables: a factor variable (date), two integer variables (count and total_count), and a numeric variable (ratio).</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="time-series-objects.html#cb55-1"></a><span class="kw">str</span>(elections_news)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    2192 obs. of  4 variables:
##  $ date       : Factor w/ 2192 levels &quot;2015-01-01&quot;,&quot;2015-01-02&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ count      : int  373 387 289 322 567 626 507 521 531 346 ...
##  $ total_count: int  25611 31932 24646 25513 39982 42366 45163 44928 44041 29093 ...
##  $ ratio      : num  0.0146 0.0121 0.0117 0.0126 0.0142 ...</code></pre>
<div id="handle-dates-and-times" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Handle Dates and Times</h3>
<p>Although it does not necessarily give problems, it’s not the best solution having a date variable coded as a factor. The most appropriate format for date variables is the format “date”. Since date and time are a very important variable in time series analysis, it is important to learn to handle them correctly. We convert the format of the date column to “Date” through the function as.Date(), specifying the format of our date.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="time-series-objects.html#cb57-1"></a>elections_news<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(elections_news<span class="op">$</span>date, <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb57-2"><a href="time-series-objects.html#cb57-2"></a><span class="kw">str</span>(elections_news)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    2192 obs. of  4 variables:
##  $ date       : Date, format: &quot;2015-01-01&quot; &quot;2015-01-02&quot; &quot;2015-01-03&quot; &quot;2015-01-04&quot; ...
##  $ count      : int  373 387 289 322 567 626 507 521 531 346 ...
##  $ total_count: int  25611 31932 24646 25513 39982 42366 45163 44928 44041 29093 ...
##  $ ratio      : num  0.0146 0.0121 0.0117 0.0126 0.0142 ...</code></pre>
<p>R use specific codes for formatting dates and times (you can read about it at the following link: <a href="https://www.stat.berkeley.edu/~s133/dates.html" class="uri">https://www.stat.berkeley.edu/~s133/dates.html</a>).</p>
<p>You can also change the format of the date by using the function format() and specifying the appropriate codes. Let’s pick up 5 dates at random and let’s apply the function. We also store the variables we create in a data.frame (just for a better visualization). You can see that the format of the date changes to factor, but the transformation could be useful in certain circumstances.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="time-series-objects.html#cb59-1"></a>dates_example &lt;-<span class="st"> </span><span class="kw">sample</span>(elections_news<span class="op">$</span>date, <span class="dt">size =</span> <span class="dv">5</span>)</span>
<span id="cb59-2"><a href="time-series-objects.html#cb59-2"></a></span>
<span id="cb59-3"><a href="time-series-objects.html#cb59-3"></a><span class="kw">data.frame</span>(<span class="st">&quot;Format_1&quot;</span> =<span class="st"> </span>dates_example,</span>
<span id="cb59-4"><a href="time-series-objects.html#cb59-4"></a>           <span class="st">&quot;Format_2&quot;</span> =<span class="st"> </span><span class="kw">format</span>(dates_example,<span class="st">&quot;%d/%m/%Y&quot;</span>),</span>
<span id="cb59-5"><a href="time-series-objects.html#cb59-5"></a>           <span class="st">&quot;Format_3&quot;</span> =<span class="st"> </span><span class="kw">format</span>(dates_example,<span class="st">&quot;%A, %B %d (%Y)&quot;</span>))</span></code></pre></div>
<pre><code>##     Format_1   Format_2                      Format_3
## 1 2019-10-03 03/10/2019   Thursday, October 03 (2019)
## 2 2015-06-19 19/06/2015        Friday, June 19 (2015)
## 3 2016-12-28 28/12/2016 Wednesday, December 28 (2016)
## 4 2018-09-09 09/09/2018   Sunday, September 09 (2018)
## 5 2015-09-05 05/09/2015 Saturday, September 05 (2015)</code></pre>
<p>Just to make an example with date and times, we upload the following file.
Let`s set aside for now that the series is not regular, and focus just on the format of the date_time variable.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="time-series-objects.html#cb61-1"></a>date_time_example &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;./data/date_time_example.csv&quot;</span>)</span>
<span id="cb61-2"><a href="time-series-objects.html#cb61-2"></a><span class="kw">head</span>(date_time_example)</span></code></pre></div>
<pre><code>##             date_time       score
## 1 2012-01-08 21:39:15 0.004061633
## 2 2012-01-10 22:07:54 0.150770079
## 3 2012-01-14 11:15:14 0.457829612
## 4 2012-01-16 18:30:46 0.485773450
## 5 2012-01-18 12:16:56 0.121030670
## 6 2012-01-19 16:03:07 0.465606862</code></pre>
<p>If we use the function as.Date() on this data, we get a date without the hours.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="time-series-objects.html#cb63-1"></a><span class="kw">head</span>(<span class="kw">as.Date</span>(date_time_example<span class="op">$</span>date_time))</span></code></pre></div>
<pre><code>## [1] &quot;2012-01-08&quot; &quot;2012-01-10&quot; &quot;2012-01-14&quot; &quot;2012-01-16&quot; &quot;2012-01-18&quot; &quot;2012-01-19&quot;</code></pre>
<p>To represent calendar dates and times properly, we can use the function as.POSIXct(). We can set also the appropriate time zone (tz). A time zone is a designated area of the globe that observes a uniform standard time (<a href="https://en.wikipedia.org/wiki/Time_zone" class="uri">https://en.wikipedia.org/wiki/Time_zone</a>)</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="time-series-objects.html#cb65-1"></a>date_time_example<span class="op">$</span>date_time &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(date_time_example<span class="op">$</span>date_time, <span class="dt">tz=</span><span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb65-2"><a href="time-series-objects.html#cb65-2"></a><span class="kw">str</span>(date_time_example)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    100 obs. of  2 variables:
##  $ date_time: POSIXct, format: &quot;2012-01-08 21:39:15&quot; &quot;2012-01-10 22:07:54&quot; &quot;2012-01-14 11:15:14&quot; &quot;2012-01-16 18:30:46&quot; ...
##  $ score    : num  0.00406 0.15077 0.45783 0.48577 0.12103 ...</code></pre>
<p>Once converted in POSIXct format, we can round or truncate our date time by minutes, hours, and days, if we want. We also need to apply again the function as.POSIXct().</p>
<p>By ispecting the results is easy to understand the difference between “round” and “trunc”.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="time-series-objects.html#cb67-1"></a>date_time_example<span class="op">$</span>round_mins &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">round</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;mins&quot;</span>))</span>
<span id="cb67-2"><a href="time-series-objects.html#cb67-2"></a>date_time_example<span class="op">$</span>trunc_mins &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">trunc</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;mins&quot;</span>))</span>
<span id="cb67-3"><a href="time-series-objects.html#cb67-3"></a></span>
<span id="cb67-4"><a href="time-series-objects.html#cb67-4"></a>date_time_example<span class="op">$</span>round_hours &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">round</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;hours&quot;</span>))</span>
<span id="cb67-5"><a href="time-series-objects.html#cb67-5"></a>date_time_example<span class="op">$</span>trunc_hours &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">trunc</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;hours&quot;</span>))</span>
<span id="cb67-6"><a href="time-series-objects.html#cb67-6"></a></span>
<span id="cb67-7"><a href="time-series-objects.html#cb67-7"></a>date_time_example<span class="op">$</span>round_days &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">round</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;days&quot;</span>))</span>
<span id="cb67-8"><a href="time-series-objects.html#cb67-8"></a>date_time_example<span class="op">$</span>trunc_days &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">trunc</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;days&quot;</span>))</span>
<span id="cb67-9"><a href="time-series-objects.html#cb67-9"></a></span>
<span id="cb67-10"><a href="time-series-objects.html#cb67-10"></a>date_time_example<span class="op">$</span>round_months &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">round</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;months&quot;</span>))</span>
<span id="cb67-11"><a href="time-series-objects.html#cb67-11"></a>date_time_example<span class="op">$</span>trunc_months &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">trunc</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;months&quot;</span>))</span>
<span id="cb67-12"><a href="time-series-objects.html#cb67-12"></a></span>
<span id="cb67-13"><a href="time-series-objects.html#cb67-13"></a>date_time_example<span class="op">$</span>round_years &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">round</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;years&quot;</span>))</span>
<span id="cb67-14"><a href="time-series-objects.html#cb67-14"></a>date_time_example<span class="op">$</span>trunc_years &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">trunc</span>(date_time_example<span class="op">$</span>date_time, <span class="st">&quot;years&quot;</span>))</span>
<span id="cb67-15"><a href="time-series-objects.html#cb67-15"></a></span>
<span id="cb67-16"><a href="time-series-objects.html#cb67-16"></a><span class="kw">head</span>(<span class="kw">as_tibble</span>(date_time_example))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 12
##   date_time             score round_mins          trunc_mins          round_hours         trunc_hours        
##   &lt;dttm&gt;                &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;dttm&gt;              &lt;dttm&gt;             
## 1 2012-01-08 21:39:15 0.00406 2012-01-08 21:39:00 2012-01-08 21:39:00 2012-01-08 22:00:00 2012-01-08 21:00:00
## 2 2012-01-10 22:07:54 0.151   2012-01-10 22:08:00 2012-01-10 22:07:00 2012-01-10 22:00:00 2012-01-10 22:00:00
## 3 2012-01-14 11:15:14 0.458   2012-01-14 11:15:00 2012-01-14 11:15:00 2012-01-14 11:00:00 2012-01-14 11:00:00
## 4 2012-01-16 18:30:46 0.486   2012-01-16 18:31:00 2012-01-16 18:30:00 2012-01-16 19:00:00 2012-01-16 18:00:00
## 5 2012-01-18 12:16:56 0.121   2012-01-18 12:17:00 2012-01-18 12:16:00 2012-01-18 12:00:00 2012-01-18 12:00:00
## 6 2012-01-19 16:03:07 0.466   2012-01-19 16:03:00 2012-01-19 16:03:00 2012-01-19 16:00:00 2012-01-19 16:00:00
## # … with 6 more variables: round_days &lt;dttm&gt;, trunc_days &lt;dttm&gt;, round_months &lt;dttm&gt;, trunc_months &lt;dttm&gt;, round_years &lt;dttm&gt;,
## #   trunc_years &lt;dttm&gt;</code></pre>
</div>
<div id="aggregate-observations" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Aggregate Observations</h3>
<p>Besides analyzing the structure, To familiarize with a dataset we can display the first few rows with the function head(). As you can see in the column date we have a time series with daily frequency.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="time-series-objects.html#cb69-1"></a><span class="kw">head</span>(elections_news)</span></code></pre></div>
<pre><code>##         date count total_count      ratio
## 1 2015-01-01   373       25611 0.01456405
## 2 2015-01-02   387       31932 0.01211950
## 3 2015-01-03   289       24646 0.01172604
## 4 2015-01-04   322       25513 0.01262102
## 5 2015-01-05   567       39982 0.01418138
## 6 2015-01-06   626       42366 0.01477600</code></pre>
<p>As said above, the frequency at which the observations were taken is assumed to be regular over time. However, very often the data are incomplete, or the frequency can be not constant due to leap years (with 366 days instead of 365).</p>
<p>In this first example, to keep things simple, we aggregate observations into monthly groups. We will see two strategies. The first one makes use of standard R function, the second one will use the library tidyverse.</p>
<div id="base-r-approach" class="section level4">
<h4><span class="header-section-number">4.2.2.1</span> Base R Approach</h4>
<p>First we instruct R to treat the “date” column as a “Date” object, which is the most correct data type for dates. Then we create another column named “month”, manipulating the dates in order to keep just years and months. We also create a column year, just to check how many months of data we have each year by using the function “aggregate”.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="time-series-objects.html#cb71-1"></a>elections_news<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(elections_news<span class="op">$</span>date, <span class="dt">format=</span><span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb71-2"><a href="time-series-objects.html#cb71-2"></a>elections_news<span class="op">$</span>month &lt;-<span class="st"> </span><span class="kw">format</span>(elections_news<span class="op">$</span>date, <span class="st">&quot;%Y-%m&quot;</span>)</span>
<span id="cb71-3"><a href="time-series-objects.html#cb71-3"></a>elections_news<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">format</span>(elections_news<span class="op">$</span>date, <span class="st">&quot;%Y&quot;</span>)</span>
<span id="cb71-4"><a href="time-series-objects.html#cb71-4"></a></span>
<span id="cb71-5"><a href="time-series-objects.html#cb71-5"></a><span class="kw">aggregate</span>(month <span class="op">~</span><span class="st"> </span>year, <span class="dt">data=</span>elections_news, <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</span></code></pre></div>
<pre><code>##   year month
## 1 2015    12
## 2 2016    12
## 3 2017    12
## 4 2018    12
## 5 2019    12
## 6 2020    12</code></pre>
<p>Finally, we use, again, the function “aggregate” to calculate the average proportion of news articles by month, creating a new dataset called “elections_news_monthly”, with a column “month” and another column “count” (the number of news articles).</p>
<p>We use the ratio value because the number of newspapers included in the collections could change over time, so by using the ratio value we account for possible changes in count of news articles determined just by changes in newspapers number and not in the news coverage of the topic.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="time-series-objects.html#cb73-1"></a>elections_news_monthly &lt;-<span class="st"> </span><span class="kw">aggregate</span>(ratio <span class="op">~</span><span class="st"> </span>month, <span class="dt">data =</span> elections_news, </span>
<span id="cb73-2"><a href="time-series-objects.html#cb73-2"></a>                                    <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw">mean</span>(x)) </span></code></pre></div>
</div>
<div id="tidyverse-approach" class="section level4">
<h4><span class="header-section-number">4.2.2.2</span> Tidyverse approach</h4>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="time-series-objects.html#cb74-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb74-2"><a href="time-series-objects.html#cb74-2"></a></span>
<span id="cb74-3"><a href="time-series-objects.html#cb74-3"></a>elections_news <span class="op">%&gt;%</span></span>
<span id="cb74-4"><a href="time-series-objects.html#cb74-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date)) <span class="op">%&gt;%</span></span>
<span id="cb74-5"><a href="time-series-objects.html#cb74-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">format</span>(date, <span class="st">&quot;%Y-%m&quot;</span>),</span>
<span id="cb74-6"><a href="time-series-objects.html#cb74-6"></a>         <span class="dt">year =</span> <span class="kw">format</span>(date, <span class="st">&quot;%Y&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb74-7"><a href="time-series-objects.html#cb74-7"></a><span class="st">  </span><span class="kw">select</span>(year, month) <span class="op">%&gt;%</span></span>
<span id="cb74-8"><a href="time-series-objects.html#cb74-8"></a><span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span></span>
<span id="cb74-9"><a href="time-series-objects.html#cb74-9"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb74-10"><a href="time-series-objects.html#cb74-10"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   year      n
##   &lt;chr&gt; &lt;int&gt;
## 1 2015     12
## 2 2016     12
## 3 2017     12
## 4 2018     12
## 5 2019     12
## 6 2020     12</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="time-series-objects.html#cb77-1"></a>elections_news_monthly &lt;-<span class="st"> </span>elections_news <span class="op">%&gt;%</span></span>
<span id="cb77-2"><a href="time-series-objects.html#cb77-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date)) <span class="op">%&gt;%</span></span>
<span id="cb77-3"><a href="time-series-objects.html#cb77-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">format</span>(date, <span class="st">&quot;%Y-%m&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb77-4"><a href="time-series-objects.html#cb77-4"></a><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span></span>
<span id="cb77-5"><a href="time-series-objects.html#cb77-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">ratio =</span> <span class="kw">mean</span>(ratio))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<p>We can look at the start and end date of the series by using the function “head” and “tail”, indicating to extract just 1 value (the first and the last one).</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="time-series-objects.html#cb79-1"></a><span class="kw">head</span>(elections_news_monthly<span class="op">$</span>month, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2015-01&quot;</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="time-series-objects.html#cb81-1"></a><span class="kw">tail</span>(elections_news_monthly<span class="op">$</span>month, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-12&quot;</code></pre>
<p>Now we can create our monthly time series object with our news media data on “elections”. We need to specify the column that contains the data, the time of the first and last observation, and the frequency of the data, which in this case is a monthly frequency.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="time-series-objects.html#cb83-1"></a>elections_news_monthly_ts &lt;-<span class="st"> </span><span class="kw">ts</span>(<span class="dt">data =</span> elections_news_monthly<span class="op">$</span>ratio, </span>
<span id="cb83-2"><a href="time-series-objects.html#cb83-2"></a>                                <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">01</span>), <span class="dt">end =</span> <span class="kw">c</span>(<span class="dv">2020</span>, <span class="dv">12</span>),</span>
<span id="cb83-3"><a href="time-series-objects.html#cb83-3"></a>                                <span class="dt">frequency =</span> <span class="dv">12</span>)</span></code></pre></div>
<p>And here it is our brand-new time series ts object.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="time-series-objects.html#cb84-1"></a>elections_news_monthly_ts</span></code></pre></div>
<pre><code>##              Jan         Feb         Mar         Apr         May         Jun         Jul         Aug         Sep         Oct
## 2015 0.012912979 0.013129067 0.013194189 0.011098454 0.010715705 0.009965726 0.009093045 0.010513101 0.011176887 0.013368316
## 2016 0.011572940 0.012884552 0.014020827 0.014176515 0.015142212 0.012419896 0.012352255 0.013319360 0.014525895 0.018165145
## 2017 0.014920648 0.015368007 0.015542559 0.015040222 0.014923517 0.014033210 0.012484787 0.010990920 0.012142076 0.012965708
## 2018 0.014746712 0.016387355 0.019550906 0.018077469 0.020748120 0.018384512 0.020848713 0.020813585 0.023878970 0.031206151
## 2019 0.020930706 0.021663593 0.023481836 0.024754292 0.026618620 0.015513945 0.014032455 0.013579769 0.017183966 0.017279698
## 2020 0.015427546 0.017116988 0.012344645 0.009973017 0.009000833 0.011735883 0.013033643 0.017377946 0.015818565 0.021178313
##              Nov         Dec
## 2015 0.013037089 0.011173882
## 2016 0.021795226 0.017023243
## 2017 0.015048326 0.015074379
## 2018 0.038497943 0.021428382
## 2019 0.019885423 0.017271081
## 2020 0.027026379 0.015476051</code></pre>
<p>We can plot our time series by using the plot.ts function.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="time-series-objects.html#cb86-1"></a><span class="kw">plot.ts</span>(elections_news_monthly_ts, </span>
<span id="cb86-2"><a href="time-series-objects.html#cb86-2"></a>     <span class="dt">main =</span> <span class="st">&quot;MediaCloud Data on Elections&quot;</span>,</span>
<span id="cb86-3"><a href="time-series-objects.html#cb86-3"></a>     <span class="dt">ylab=</span><span class="st">&quot;News Articles&quot;</span>, </span>
<span id="cb86-4"><a href="time-series-objects.html#cb86-4"></a>     <span class="dt">col =</span> <span class="st">&quot;purple3&quot;</span>,</span>
<span id="cb86-5"><a href="time-series-objects.html#cb86-5"></a>     <span class="dt">lwd =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-150-1.png" width="672" /></p>
<p>Now, we save our time series object in the folder “data” for further analysis.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="time-series-objects.html#cb87-1"></a><span class="kw">saveRDS</span>(elections_news_monthly_ts, <span class="st">&quot;./data/elections_news_monthly_ts.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="irregular-frequencies" class="section level2">
<h2><span class="header-section-number">4.3</span> Irregular Frequencies</h2>
<p>Time series point are expected to be regular in time, collected at metronomic intervals. However, this is not always possible.</p>
<p>For instance, if you have a daily time series that spans over many years, you will have leap years with 366 days instead of 365 (by extending February to 29 days rather than the common 28).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="time-series-objects.html#cb88-1"></a><span class="kw">aggregate</span>(date <span class="op">~</span><span class="st"> </span>year, <span class="dt">data=</span>elections_news, <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</span></code></pre></div>
<pre><code>##   year date
## 1 2015  365
## 2 2016  366
## 3 2017  365
## 4 2018  365
## 5 2019  365
## 6 2020  366</code></pre>
<p>The standard time series library in R does not work well with daily time series. It works fine with yearly, monthly, quarterly data. There are other time series analysis libraries in R, for instance “xts”, but to perform some analyses regular intervals are mandatory.</p>
<p>To regularize the time series you might choose to delete a data point, or to aggregate daily data by months, as we have done above.</p>
<p>If we just want to plot a daily time series we can simply use ggplot2. We can use our original dataset, which is a “data.frame” object.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="time-series-objects.html#cb90-1"></a><span class="kw">class</span>(elections_news)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="time-series-objects.html#cb92-1"></a><span class="kw">ggplot</span>(elections_news, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ratio)) <span class="op">+</span></span>
<span id="cb92-2"><a href="time-series-objects.html#cb92-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col =</span> <span class="st">&quot;gold2&quot;</span>,</span>
<span id="cb92-3"><a href="time-series-objects.html#cb92-3"></a>            <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb92-4"><a href="time-series-objects.html#cb92-4"></a><span class="st">     </span><span class="kw">ylab</span>(<span class="st">&quot;News Articles&quot;</span>) <span class="op">+</span></span>
<span id="cb92-5"><a href="time-series-objects.html#cb92-5"></a><span class="st">     </span><span class="kw">ggtitle</span>(<span class="st">&quot;MediaCloud Data on Elections (Daily)&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-153-1.png" width="672" /></p>
</div>
<div id="incomplete-data-points" class="section level2">
<h2><span class="header-section-number">4.4</span> Incomplete Data Points</h2>
<p>Another problem we often have to deal with when we analyze time series is related to incomplete data points. In this case we need to complete the data.</p>
<p>First of all we need to create the missing date-time slots, if there are any. We are going to fill them with 0 since we consider that point missing just because they have zero events in them. However, this is not necessarily the case, and if they are missing for other reason we should fill them with NA and choose an approach to handle them.</p>
<p>For instance, the following time series lacks the first four days of the first year of data. Not only the data are missing, but also the time slots.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="time-series-objects.html#cb93-1"></a>elections_news_incomplete &lt;-<span class="st"> </span>elections_news[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),]</span>
<span id="cb93-2"><a href="time-series-objects.html#cb93-2"></a></span>
<span id="cb93-3"><a href="time-series-objects.html#cb93-3"></a><span class="kw">head</span>(elections_news_incomplete)</span></code></pre></div>
<pre><code>##          date count total_count      ratio   month year
## 5  2015-01-05   567       39982 0.01418138 2015-01 2015
## 6  2015-01-06   626       42366 0.01477600 2015-01 2015
## 7  2015-01-07   507       45163 0.01122600 2015-01 2015
## 8  2015-01-08   521       44928 0.01159633 2015-01 2015
## 9  2015-01-09   531       44041 0.01205695 2015-01 2015
## 10 2015-01-10   346       29093 0.01189290 2015-01 2015</code></pre>
<p>To create the necessary time slots, we can use the function complete() in the package “tidyverse”.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="time-series-objects.html#cb95-1"></a>elections_news_complete &lt;-<span class="st"> </span>elections_news_incomplete <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-2"><a href="time-series-objects.html#cb95-2"></a><span class="st">  </span><span class="kw">complete</span>(<span class="dt">date =</span> <span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2015-01-01&quot;</span>), <span class="kw">max</span>(date), <span class="dt">by =</span> <span class="st">&quot;1 day&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb95-3"><a href="time-series-objects.html#cb95-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ratio =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(ratio), <span class="dv">0</span>, ratio))</span></code></pre></div>
<p>Now we can plot our completed time series using the ggplot() function.
You can just copy the previous code and change some parameters (first of all the name of the dataset).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="time-series-objects.html#cb96-1"></a><span class="kw">ggplot</span>(elections_news_complete, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ratio)) <span class="op">+</span></span>
<span id="cb96-2"><a href="time-series-objects.html#cb96-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.75</span>) <span class="op">+</span></span>
<span id="cb96-3"><a href="time-series-objects.html#cb96-3"></a><span class="st">     </span><span class="kw">ylab</span>(<span class="st">&quot;News Articles&quot;</span>) <span class="op">+</span></span>
<span id="cb96-4"><a href="time-series-objects.html#cb96-4"></a><span class="st">     </span><span class="kw">ggtitle</span>(<span class="st">&quot;MediaCloud Data on Elections (Daily)&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
</div>
<div id="plot-many-time-series" class="section level2">
<h2><span class="header-section-number">4.5</span> Plot Many Time Series</h2>
<p>You can also plot two time series together. This could be useful to have a look at their possible relations. The two time series must have the same starting date, the same ending date, and the same frequency.</p>
<p>In base R, the time series have to be merged in one “ts” object by using the function ts.union(). You can plot both the time series in the same plot, or create two different plot, by using the option “plot.type”.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="time-series-objects.html#cb97-1"></a>AirPassengers_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dt">x =</span> <span class="kw">length</span>(AirPassengers))</span>
<span id="cb97-2"><a href="time-series-objects.html#cb97-2"></a></span>
<span id="cb97-3"><a href="time-series-objects.html#cb97-3"></a>AirPassengers_two_series &lt;-<span class="st"> </span><span class="kw">ts.union</span>(AirPassengers, AirPassengers_<span class="dv">2</span>)</span>
<span id="cb97-4"><a href="time-series-objects.html#cb97-4"></a></span>
<span id="cb97-5"><a href="time-series-objects.html#cb97-5"></a><span class="kw">plot.ts</span>(AirPassengers_two_series, </span>
<span id="cb97-6"><a href="time-series-objects.html#cb97-6"></a>        <span class="dt">main =</span> <span class="st">&quot;MediaCloud Data on Elections (Daily)</span><span class="ch">\n</span><span class="st">and Random Sample&quot;</span>,</span>
<span id="cb97-7"><a href="time-series-objects.html#cb97-7"></a>        <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb97-8"><a href="time-series-objects.html#cb97-8"></a>        <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">lwd=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb97-9"><a href="time-series-objects.html#cb97-9"></a>        <span class="dt">plot.type =</span> <span class="st">&quot;single&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="time-series-objects.html#cb98-1"></a><span class="kw">plot.ts</span>(AirPassengers_two_series, </span>
<span id="cb98-2"><a href="time-series-objects.html#cb98-2"></a>        <span class="dt">main =</span> <span class="st">&quot;MediaCloud Data on Elections (Daily)</span><span class="ch">\n</span><span class="st">and Random Sample&quot;</span>,</span>
<span id="cb98-3"><a href="time-series-objects.html#cb98-3"></a>        <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb98-4"><a href="time-series-objects.html#cb98-4"></a>        <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">1</span>,</span>
<span id="cb98-5"><a href="time-series-objects.html#cb98-5"></a>        <span class="dt">plot.type =</span> <span class="st">&quot;multiple&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-157-2.png" width="672" /></p>
<p>To plot the series with ggplot2, we can use a code like the following.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="time-series-objects.html#cb99-1"></a><span class="kw">ggplot</span>(elections_news) <span class="op">+</span></span>
<span id="cb99-2"><a href="time-series-objects.html#cb99-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ratio), <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb99-3"><a href="time-series-objects.html#cb99-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> count<span class="op">/</span><span class="dv">100000</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb99-4"><a href="time-series-objects.html#cb99-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;News Articles&quot;</span>) <span class="op">+</span></span>
<span id="cb99-5"><a href="time-series-objects.html#cb99-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span></span>
<span id="cb99-6"><a href="time-series-objects.html#cb99-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;MediaCloud Data on Elections (Daily)&quot;</span>) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="time-series-objects.html#cb100-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(elections_news) <span class="op">+</span></span>
<span id="cb100-2"><a href="time-series-objects.html#cb100-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ratio), <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb100-3"><a href="time-series-objects.html#cb100-3"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;News Articles&quot;</span>) <span class="op">+</span></span>
<span id="cb100-4"><a href="time-series-objects.html#cb100-4"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span></span>
<span id="cb100-5"><a href="time-series-objects.html#cb100-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;MediaCloud Data on Elections (Daily)&quot;</span>) </span>
<span id="cb100-6"><a href="time-series-objects.html#cb100-6"></a></span>
<span id="cb100-7"><a href="time-series-objects.html#cb100-7"></a></span>
<span id="cb100-8"><a href="time-series-objects.html#cb100-8"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(elections_news) <span class="op">+</span></span>
<span id="cb100-9"><a href="time-series-objects.html#cb100-9"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> count), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb100-10"><a href="time-series-objects.html#cb100-10"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;News Articles&quot;</span>) <span class="op">+</span></span>
<span id="cb100-11"><a href="time-series-objects.html#cb100-11"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span></span>
<span id="cb100-12"><a href="time-series-objects.html#cb100-12"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;MediaCloud Data on Elections (Daily)&quot;</span>) </span>
<span id="cb100-13"><a href="time-series-objects.html#cb100-13"></a></span>
<span id="cb100-14"><a href="time-series-objects.html#cb100-14"></a>gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(p1,p2)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-158-2.png" width="672" /></p>
</div>
<div id="find-and-annotate-peaks" class="section level2">
<h2><span class="header-section-number">4.6</span> Find and Annotate Peaks</h2>
<p>Plotting a time series has an important role in a preliminary phase of the analysis, which consists in a first exploration of the data.</p>
<p>A very common and interesting step in the analysis of time series data is the detection of peaks, data point that have a very high value compared to the others. When studying social and communications phenomena, these unexpected change in the process that characterizes a time series, attract our attention and requires an explanation. Often, peaks are associated with some external phenomena that had an impact on the time series. It is a common practice to detect these peak and label the time series plot with a few words indicating the phenomenon with which the peak is, most probably, associated with.</p>
<p>For instance, with our daily time series data of news on elections, we might be interested in detecting and labelling the highest peak.</p>
<p>First, we extract the highest value .</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="time-series-objects.html#cb101-1"></a>elections_news <span class="op">%&gt;%</span></span>
<span id="cb101-2"><a href="time-series-objects.html#cb101-2"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>ratio) <span class="op">%&gt;%</span></span>
<span id="cb101-3"><a href="time-series-objects.html#cb101-3"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, ratio)</span></code></pre></div>
<pre><code>##         date count total_count      ratio   month year
## 1 2018-11-06  9529       98704 0.09654117 2018-11 2018</code></pre>
<p>To create the annotation in ggplot we use the function “annotate”, to label the data point, and “geom_segment”, to trace a line that connects the data point with the label.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="time-series-objects.html#cb103-1"></a><span class="kw">ggplot</span>(elections_news) <span class="op">+</span></span>
<span id="cb103-2"><a href="time-series-objects.html#cb103-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ratio), <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb103-3"><a href="time-series-objects.html#cb103-3"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;News Articles&quot;</span>) <span class="op">+</span></span>
<span id="cb103-4"><a href="time-series-objects.html#cb103-4"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span></span>
<span id="cb103-5"><a href="time-series-objects.html#cb103-5"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.150</span>)) <span class="op">+</span></span>
<span id="cb103-6"><a href="time-series-objects.html#cb103-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;MediaCloud Data on Elections (Daily)&quot;</span>) <span class="op">+</span></span>
<span id="cb103-7"><a href="time-series-objects.html#cb103-7"></a><span class="st">  </span><span class="co"># annotation</span></span>
<span id="cb103-8"><a href="time-series-objects.html#cb103-8"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;label&quot;</span>, <span class="dt">x =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-11-06&quot;</span>), <span class="dt">y =</span> <span class="fl">0.130</span>, <span class="dt">label =</span> <span class="st">&quot;Highest Peak</span><span class="ch">\n</span><span class="st">2018-11-06&quot;</span>, </span>
<span id="cb103-9"><a href="time-series-objects.html#cb103-9"></a>           <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">fontface=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb103-10"><a href="time-series-objects.html#cb103-10"></a><span class="st">  </span><span class="co"># arrow</span></span>
<span id="cb103-11"><a href="time-series-objects.html#cb103-11"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">ends =</span> <span class="st">&quot;first&quot;</span>), </span>
<span id="cb103-12"><a href="time-series-objects.html#cb103-12"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-11-06&quot;</span>), <span class="dt">y =</span> <span class="fl">0.1</span>, </span>
<span id="cb103-13"><a href="time-series-objects.html#cb103-13"></a>                   <span class="dt">xend =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-11-06&quot;</span>), <span class="dt">yend =</span> <span class="fl">0.120</span>), </span>
<span id="cb103-14"><a href="time-series-objects.html#cb103-14"></a>               <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
<p>To make another example, by using the formatting functions we have seen above, we transform the time series in a monthly time series, than we annotate the 4 highest peaks. We use a tidyverse approach.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="time-series-objects.html#cb104-1"></a>elections_news_monthly &lt;-<span class="st"> </span>elections_news <span class="op">%&gt;%</span></span>
<span id="cb104-2"><a href="time-series-objects.html#cb104-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_month =</span> <span class="kw">as.POSIXct</span>(<span class="kw">trunc</span>(<span class="kw">as.POSIXct</span>(date), <span class="st">&quot;month&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb104-3"><a href="time-series-objects.html#cb104-3"></a><span class="st">  </span><span class="kw">group_by</span>(date_month) <span class="op">%&gt;%</span></span>
<span id="cb104-4"><a href="time-series-objects.html#cb104-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">ratio =</span> <span class="kw">mean</span>(ratio))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="time-series-objects.html#cb106-1"></a>elections_news_monthly <span class="op">%&gt;%</span></span>
<span id="cb106-2"><a href="time-series-objects.html#cb106-2"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>ratio) <span class="op">%&gt;%</span></span>
<span id="cb106-3"><a href="time-series-objects.html#cb106-3"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">4</span>, ratio)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   date_month           ratio
##   &lt;dttm&gt;               &lt;dbl&gt;
## 1 2018-11-01 00:00:00 0.0385
## 2 2018-10-01 00:00:00 0.0312
## 3 2020-11-01 00:00:00 0.0270
## 4 2019-05-01 00:00:00 0.0266</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="time-series-objects.html#cb108-1"></a><span class="kw">ggplot</span>(elections_news_monthly) <span class="op">+</span></span>
<span id="cb108-2"><a href="time-series-objects.html#cb108-2"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date_month, <span class="dt">y =</span> ratio), <span class="dt">col =</span> <span class="st">&quot;skyblue2&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb108-3"><a href="time-series-objects.html#cb108-3"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;News Articles&quot;</span>) <span class="op">+</span></span>
<span id="cb108-4"><a href="time-series-objects.html#cb108-4"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span></span>
<span id="cb108-5"><a href="time-series-objects.html#cb108-5"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.120</span>)) <span class="op">+</span></span>
<span id="cb108-6"><a href="time-series-objects.html#cb108-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;MediaCloud Data on Elections (Monthly)&quot;</span>) <span class="op">+</span></span>
<span id="cb108-7"><a href="time-series-objects.html#cb108-7"></a><span class="st">  </span></span>
<span id="cb108-8"><a href="time-series-objects.html#cb108-8"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;label&quot;</span>, <span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2018-11-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.1</span>, <span class="dt">label =</span> <span class="st">&quot;Highest Peak 1</span><span class="ch">\n</span><span class="st">2018-11&quot;</span>, </span>
<span id="cb108-9"><a href="time-series-objects.html#cb108-9"></a>           <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">fontface=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb108-10"><a href="time-series-objects.html#cb108-10"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">ends =</span> <span class="st">&quot;first&quot;</span>), </span>
<span id="cb108-11"><a href="time-series-objects.html#cb108-11"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2018-11-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.043</span>, </span>
<span id="cb108-12"><a href="time-series-objects.html#cb108-12"></a>                   <span class="dt">xend =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2018-11-01&quot;</span>), <span class="dt">yend =</span> <span class="fl">0.090</span>), </span>
<span id="cb108-13"><a href="time-series-objects.html#cb108-13"></a>               <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb108-14"><a href="time-series-objects.html#cb108-14"></a><span class="st">  </span></span>
<span id="cb108-15"><a href="time-series-objects.html#cb108-15"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;label&quot;</span>, <span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2018-04-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.08</span>, <span class="dt">label =</span> <span class="st">&quot;Highest Peak 2</span><span class="ch">\n</span><span class="st">2018-10&quot;</span>, </span>
<span id="cb108-16"><a href="time-series-objects.html#cb108-16"></a>           <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">fontface=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb108-17"><a href="time-series-objects.html#cb108-17"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">ends =</span> <span class="st">&quot;first&quot;</span>), </span>
<span id="cb108-18"><a href="time-series-objects.html#cb108-18"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2018-10-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.036</span>, </span>
<span id="cb108-19"><a href="time-series-objects.html#cb108-19"></a>                   <span class="dt">xend =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2018-04-01&quot;</span>), <span class="dt">yend =</span> <span class="fl">0.07</span>), </span>
<span id="cb108-20"><a href="time-series-objects.html#cb108-20"></a>               <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb108-21"><a href="time-series-objects.html#cb108-21"></a><span class="st">  </span></span>
<span id="cb108-22"><a href="time-series-objects.html#cb108-22"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;label&quot;</span>, <span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.06</span>, <span class="dt">label =</span> <span class="st">&quot;Highest Peak 3</span><span class="ch">\n</span><span class="st">2020-11&quot;</span>, </span>
<span id="cb108-23"><a href="time-series-objects.html#cb108-23"></a>           <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">fontface=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb108-24"><a href="time-series-objects.html#cb108-24"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">ends =</span> <span class="st">&quot;first&quot;</span>), </span>
<span id="cb108-25"><a href="time-series-objects.html#cb108-25"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-11-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.032</span>, </span>
<span id="cb108-26"><a href="time-series-objects.html#cb108-26"></a>                   <span class="dt">xend =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2020-09-01&quot;</span>), <span class="dt">yend =</span> <span class="fl">0.05</span>), </span>
<span id="cb108-27"><a href="time-series-objects.html#cb108-27"></a>               <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb108-28"><a href="time-series-objects.html#cb108-28"></a><span class="st">  </span></span>
<span id="cb108-29"><a href="time-series-objects.html#cb108-29"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;label&quot;</span>, <span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2019-06-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.05</span>, <span class="dt">label =</span> <span class="st">&quot;Highest Peak 4</span><span class="ch">\n</span><span class="st">2019-05&quot;</span>, </span>
<span id="cb108-30"><a href="time-series-objects.html#cb108-30"></a>           <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">fontface=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb108-31"><a href="time-series-objects.html#cb108-31"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">ends =</span> <span class="st">&quot;first&quot;</span>), </span>
<span id="cb108-32"><a href="time-series-objects.html#cb108-32"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2019-05-01&quot;</span>), <span class="dt">y =</span> <span class="fl">0.031</span>, </span>
<span id="cb108-33"><a href="time-series-objects.html#cb108-33"></a>                   <span class="dt">xend =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2019-06-01&quot;</span>), <span class="dt">yend =</span> <span class="fl">0.04</span>), </span>
<span id="cb108-34"><a href="time-series-objects.html#cb108-34"></a>               <span class="dt">color =</span> <span class="st">&quot;#FC4E07&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">linetype =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidyverse.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-caucus-race-and-a-long-tale.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nicolarighetti/Introduction-to-Time-Series-Analysis-With-R/edit/master/03-time-series-objects.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/nicolarighetti/Introduction-to-Time-Series-Analysis-With-R/blob/master/03-time-series-objects.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
