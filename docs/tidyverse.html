<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Tidyverse | Introduction to Time Series Analysis With R</title>
  <meta name="description" content="Chapter 3 Tidyverse | Introduction to Time Series Analysis With R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Tidyverse | Introduction to Time Series Analysis With R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Tidyverse | Introduction to Time Series Analysis With R" />
  
  
  

<meta name="author" content="Nicola Righetti" />


<meta name="date" content="2021-02-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basic-r-syntax-and-the-tidyverse-package.html"/>
<link rel="next" href="time-series-objects.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Time Series with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to Time Series Analysis With R</a></li>
<li class="chapter" data-level="2" data-path="basic-r-syntax-and-the-tidyverse-package.html"><a href="basic-r-syntax-and-the-tidyverse-package.html"><i class="fa fa-check"></i><b>2</b> Basic R Syntax and the Tidyverse Package</a><ul>
<li class="chapter" data-level="2.1" data-path="basic-r-syntax-and-the-tidyverse-package.html"><a href="basic-r-syntax-and-the-tidyverse-package.html#objects"><i class="fa fa-check"></i><b>2.1</b> Objects</a></li>
<li class="chapter" data-level="2.2" data-path="basic-r-syntax-and-the-tidyverse-package.html"><a href="basic-r-syntax-and-the-tidyverse-package.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>3</b> Tidyverse</a></li>
<li class="chapter" data-level="4" data-path="time-series-objects.html"><a href="time-series-objects.html"><i class="fa fa-check"></i><b>4</b> Time Series Objects</a><ul>
<li class="chapter" data-level="4.1" data-path="time-series-objects.html"><a href="time-series-objects.html#plot-time-series-objects"><i class="fa fa-check"></i><b>4.1</b> Plot Time Series Objects</a></li>
<li class="chapter" data-level="4.2" data-path="time-series-objects.html"><a href="time-series-objects.html#create-time-series-object"><i class="fa fa-check"></i><b>4.2</b> Create Time Series Object</a><ul>
<li class="chapter" data-level="4.2.1" data-path="time-series-objects.html"><a href="time-series-objects.html#handle-dates-and-times"><i class="fa fa-check"></i><b>4.2.1</b> Handle Dates and Times</a></li>
<li class="chapter" data-level="4.2.2" data-path="time-series-objects.html"><a href="time-series-objects.html#aggregate-observations"><i class="fa fa-check"></i><b>4.2.2</b> Aggregate Observations</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="time-series-objects.html"><a href="time-series-objects.html#irregular-frequencies"><i class="fa fa-check"></i><b>4.3</b> Irregular Frequencies</a></li>
<li class="chapter" data-level="4.4" data-path="time-series-objects.html"><a href="time-series-objects.html#incomplete-data-points"><i class="fa fa-check"></i><b>4.4</b> Incomplete Data Points</a></li>
<li class="chapter" data-level="4.5" data-path="time-series-objects.html"><a href="time-series-objects.html#plot-many-time-series"><i class="fa fa-check"></i><b>4.5</b> Plot Many Time Series</a></li>
<li class="chapter" data-level="4.6" data-path="time-series-objects.html"><a href="time-series-objects.html#find-and-annotate-peaks"><i class="fa fa-check"></i><b>4.6</b> Find and Annotate Peaks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-caucus-race-and-a-long-tale.html"><a href="a-caucus-race-and-a-long-tale.html"><i class="fa fa-check"></i><b>5</b> A caucus-race and a long tale</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Time Series Analysis With R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidyverse" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Tidyverse</h1>
<p>The library tidyverse is composed of functions that allow the users to perform fundamental and advanced data science operations. In this course we are particularly interested in its use to manipulate data.frames and create plots.</p>
<p>Tidyverse has a peculiar syntax which allows users to concatenate many operations through the so-called “pipe”, that is, the following symbol: %&gt;%</p>
<p>In this example, we use tidyverse to add another variable to the data.frame by using the function “mutate”.</p>
<p>First we write the name of the object we want to create (we could keep the same name of the object we want to modify, but to be more clear we create a new object. Then, after the arrow, we write the name of the object we want to modify and the %&gt;% symbol, which precede the operation we are going to do with that object.</p>
<p>To mutate the data.frame we use the function mutate(). Its first argument is the name of the new variable we want to create, and then the operation that creates it. In this case we create the new variable as the third variable divided by three.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="tidyverse.html#cb29-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb29-2"><a href="tidyverse.html#cb29-2"></a></span>
<span id="cb29-3"><a href="tidyverse.html#cb29-3"></a>new_dataframe &lt;-<span class="st"> </span>object_consisting_in_a_dataframe <span class="op">%&gt;%</span></span>
<span id="cb29-4"><a href="tidyverse.html#cb29-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">just_another_new_variable =</span> a_new_variable <span class="op">/</span><span class="st"> </span><span class="dv">3</span>)</span>
<span id="cb29-5"><a href="tidyverse.html#cb29-5"></a>  </span>
<span id="cb29-6"><a href="tidyverse.html#cb29-6"></a>new_dataframe</span></code></pre></div>
<pre><code>##    first_variable second_variable a_new_variable just_another_new_variable
## 1               1          Monday             12                  4.000000
## 2               2         Tuesday            261                 87.000000
## 3               3       Wednesday             45                 15.000000
## 4               4        Thursday             29                  9.666667
## 5               5          Friday             54                 18.000000
## 6               6        Saturday            234                 78.000000
## 7               7          Sunday             45                 15.000000
## 8               8          Monday             42                 14.000000
## 9               9         Tuesday              6                  2.000000
## 10             10       Wednesday            267                 89.000000
## 11             11        Thursday             87                 29.000000
## 12             12          Friday              3                  1.000000
## 13             13        Saturday             12                  4.000000
## 14             14          Sunday              9                  3.000000</code></pre>
<p>To make the example more meaningful, we will suppose that the first variable represents the IDs of the dataset entries, the second variable represents the days of obseravation, the third the number of tweets published that day, and the fourth the number of users that published the tweets. We rename the columns accordingly.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="tidyverse.html#cb31-1"></a>new_dataframe &lt;-<span class="st"> </span>new_dataframe <span class="op">%&gt;%</span></span>
<span id="cb31-2"><a href="tidyverse.html#cb31-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;ID&quot;</span> =<span class="st"> </span>first_variable,</span>
<span id="cb31-3"><a href="tidyverse.html#cb31-3"></a>         <span class="st">&quot;Day&quot;</span> =<span class="st"> </span>second_variable,</span>
<span id="cb31-4"><a href="tidyverse.html#cb31-4"></a>         <span class="st">&quot;Tweets&quot;</span> =<span class="st"> </span>a_new_variable,</span>
<span id="cb31-5"><a href="tidyverse.html#cb31-5"></a>         <span class="st">&quot;Users&quot;</span> =<span class="st"> </span>just_another_new_variable)</span>
<span id="cb31-6"><a href="tidyverse.html#cb31-6"></a></span>
<span id="cb31-7"><a href="tidyverse.html#cb31-7"></a>new_dataframe</span></code></pre></div>
<pre><code>##    ID       Day Tweets     Users
## 1   1    Monday     12  4.000000
## 2   2   Tuesday    261 87.000000
## 3   3 Wednesday     45 15.000000
## 4   4  Thursday     29  9.666667
## 5   5    Friday     54 18.000000
## 6   6  Saturday    234 78.000000
## 7   7    Sunday     45 15.000000
## 8   8    Monday     42 14.000000
## 9   9   Tuesday      6  2.000000
## 10 10 Wednesday    267 89.000000
## 11 11  Thursday     87 29.000000
## 12 12    Friday      3  1.000000
## 13 13  Saturday     12  4.000000
## 14 14    Sunday      9  3.000000</code></pre>
<p>We also change the format of the values Tweets and Users, which are now of type “double”, to “integer”. The format “double” is suitable for continuous variables more that count data like the one we are supposing to use. WE also change the format of the ID column to characters, since it represents just a label. We use, again, the function “mutate”.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="tidyverse.html#cb33-1"></a>new_dataframe &lt;-<span class="st"> </span>new_dataframe <span class="op">%&gt;%</span></span>
<span id="cb33-2"><a href="tidyverse.html#cb33-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ID =</span> <span class="kw">as.character</span>(ID),</span>
<span id="cb33-3"><a href="tidyverse.html#cb33-3"></a>         <span class="dt">Tweets =</span> <span class="kw">as.integer</span>(Tweets),</span>
<span id="cb33-4"><a href="tidyverse.html#cb33-4"></a>         <span class="dt">Users =</span> <span class="kw">as.integer</span>(Users))</span>
<span id="cb33-5"><a href="tidyverse.html#cb33-5"></a></span>
<span id="cb33-6"><a href="tidyverse.html#cb33-6"></a>new_dataframe</span></code></pre></div>
<pre><code>##    ID       Day Tweets Users
## 1   1    Monday     12     4
## 2   2   Tuesday    261    87
## 3   3 Wednesday     45    15
## 4   4  Thursday     29     9
## 5   5    Friday     54    18
## 6   6  Saturday    234    78
## 7   7    Sunday     45    15
## 8   8    Monday     42    14
## 9   9   Tuesday      6     2
## 10 10 Wednesday    267    89
## 11 11  Thursday     87    29
## 12 12    Friday      3     1
## 13 13  Saturday     12     4
## 14 14    Sunday      9     3</code></pre>
<p>Now we summarize the data. For instance, we could be interested in calcuating the average numer of tweets and users by day. Thus, we aggregate the data by Day (by using the function “group_by”) and then we use the function “summarize” to calculate the average values of Tweets and Users by Day. To calculate the average values we use the function “mean”. We also order the data from the day with the highest to the lowest number of tweets, by using the function “arrange”.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="tidyverse.html#cb35-1"></a>summary_data &lt;-<span class="st"> </span>new_dataframe <span class="op">%&gt;%</span></span>
<span id="cb35-2"><a href="tidyverse.html#cb35-2"></a><span class="st">  </span><span class="kw">group_by</span>(Day) <span class="op">%&gt;%</span></span>
<span id="cb35-3"><a href="tidyverse.html#cb35-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">average_tweets =</span> <span class="kw">mean</span>(Tweets),</span>
<span id="cb35-4"><a href="tidyverse.html#cb35-4"></a>            <span class="dt">average_users =</span> <span class="kw">mean</span>(Users)) <span class="op">%&gt;%</span></span>
<span id="cb35-5"><a href="tidyverse.html#cb35-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>average_tweets)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="tidyverse.html#cb37-1"></a>summary_data</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   Day       average_tweets average_users
##   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
## 1 Wednesday          156            52  
## 2 Tuesday            134.           44.5
## 3 Saturday           123            41  
## 4 Thursday            58            19  
## 5 Friday              28.5           9.5
## 6 Monday              27             9  
## 7 Sunday              27             9</code></pre>
<p>We can plot the results of our summary by using a bar plot. The main graphical function in tidyverse is ggplot.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="tidyverse.html#cb39-1"></a><span class="kw">ggplot</span>(summary_data, <span class="kw">aes</span>(<span class="dt">x=</span>Day, <span class="dt">y=</span>average_tweets)) <span class="op">+</span></span>
<span id="cb39-2"><a href="tidyverse.html#cb39-2"></a><span class="st">  </span><span class="kw">geom_col</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<p>The plot results not ordered by the numer of tweets. We can order it by using another function (“reorder”) inside the code. We also give new colors to the bars. We also change the axis labels, give a title to the plot, and use a pre-existing theme to give a better aspect to the whole picture.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="tidyverse.html#cb40-1"></a><span class="kw">ggplot</span>(summary_data, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(Day, <span class="op">-</span>average_tweets), <span class="dt">y=</span>average_tweets)) <span class="op">+</span></span>
<span id="cb40-2"><a href="tidyverse.html#cb40-2"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">col=</span><span class="st">&quot;purple&quot;</span>, <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb40-3"><a href="tidyverse.html#cb40-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Day&quot;</span>) <span class="op">+</span></span>
<span id="cb40-4"><a href="tidyverse.html#cb40-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Tweets&quot;</span>) <span class="op">+</span></span>
<span id="cb40-5"><a href="tidyverse.html#cb40-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Tweets by Day&quot;</span>) <span class="op">+</span></span>
<span id="cb40-6"><a href="tidyverse.html#cb40-6"></a><span class="st">  </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-127-1.png" width="672" /></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="basic-r-syntax-and-the-tidyverse-package.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time-series-objects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nicolarighetti/Introduction-to-Time-Series-Analysis-With-R/edit/master/02-Basic-R-Syntax.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/nicolarighetti/Introduction-to-Time-Series-Analysis-With-R/blob/master/02-Basic-R-Syntax.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
